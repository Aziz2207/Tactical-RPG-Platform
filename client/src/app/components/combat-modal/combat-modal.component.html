<div class="combat-modal">
    <div class="turn-message">{{ combatService.turnMessage }}</div>
    <div class="top-section">
        <div class="player-info">
            <app-combat-stats-bar
                [player]="combatService.activePlayer"
                [isOnRightSide]="false"
                [isDamaged]="!combatService.isAttacker(combatService.activePlayer)"
            ></app-combat-stats-bar>
        </div>
        <div class="timer-container">
            <app-timer [totalTime]="combatTurnTime" [timeRemaining]="combatTurnTime"></app-timer>
        </div>
        <div class="player-info">
            <app-combat-stats-bar
                [player]="combatService.opponent"
                [isOnRightSide]="true"
                [isDamaged]="!combatService.isAttacker(combatService.opponent)"
            ></app-combat-stats-bar>
        </div>
    </div>
    <div class="middle-section">
        <div>
            <div class="player-avatar-container">
                <img
                    class="player-img left-player"
                    [ngClass]="{ 'active-player-border': combatService.isAttacker(combatService.activePlayer) }"
                    src="{{ activePlayer.avatar?.src }}"
                    alt="right player portrait"
                />
                <div class="damaged-overlay"></div>
            </div>
            <div class="evasions-remaining">
                @for (evasion of combatService.evasionsActivePlayer; track $index) {
                <div class="evasion-point"></div>
                }
            </div>
            <p class="evasion-text">{{ 'GAME.COMBAT.EVADE_POINTS_REMAINING' | translate }} : {{ combatService.evasionsActivePlayer.length }}</p>
        </div>
        <div class="dice-container">
            <div class="stats-and-dice-value">
                <div>{{ combatService.activePlayerResult.total }}</div>
            </div>
            <app-dice #dice2 [value]="combatService.activePlayerResult.diceValue"></app-dice>
        </div>
        <div class="dice-container">
            <div class="stats-and-dice-value">
                <div>{{ combatService.opponentResult.total }}</div>
            </div>
            <app-dice #dice1 [value]="combatService.opponentResult.diceValue"></app-dice>
        </div>
        <div>
            <div class="player-avatar-container">
                <img
                    class="player-img right-player"
                    [ngClass]="{ 'active-player-border': combatService.isAttacker(combatService.opponent) }"
                    src="{{ opponent.avatar?.src }}"
                    alt="right player portrait"
                />
                <div class="damaged-overlay"></div>
            </div>
            <div class="evasions-remaining">
                @for (evasion of combatService.evasionsOpponent; track $index) {
                <div class="evasion-point"></div>
                }
            </div>
            <p class="evasion-text">{{ 'GAME.COMBAT.EVADE_POINTS_REMAINING' | translate }} {{ combatService.evasionsOpponent.length }}</p>
        </div>
    </div>
    <div class="bottom-section">
        @if (isPlayerInCombat()) {
            <div class="evasion-container">
                <div>
                    <p class="action-text">{{ 'GAME.COMBAT.EVADE' | translate }}</p>
                    <div [class.disabled]="!canEvade()" class="button-outer end-outer" (click)="triggerEvade()">
                        <div class="evade-button"></div>
                    </div>
                </div>
            </div>
        }
        <div class="display">
            <div class="display-text">{{ combatService.combatStatus }}</div>
        </div>
        @if (isPlayerInCombat()) {
            <div>
                <p class="action-text">{{ 'GAME.COMBAT.ATTACK' | translate }}</p>
                <div [class.disabled]="!canAttack()" class="button-outer end-outer" (click)="triggerAttack()">
                    <div class="attack-button"></div>
                </div>
            </div>
        }
    </div>
</div>
