import {
    BASE_36,
    COLUMN_LENGTH,
    DEFAULT_DATE,
    DIMENSION,
    GENERATE_COUNT,
    MEDIUM_MAP_PLAYERS,
    MODES,
    NB_PLAYERS,
    NO_ITEM,
    RANDOM_ITEM,
    ROW_LENGTH,
    SIZE_MEDIUM_MAP,
    SIZE_SMALL_MAP,
    SMALL_MAP_PLAYERS,
    TILE_COUNT,
} from '@app/constants';
import { Map } from '@app/model/schema/map.schema';
import { GameState, TileType } from '@common/constants';
import { Game } from '@common/interfaces/game';
import mongoose from 'mongoose';

const getRandomString = (): string => (Math.random() + 1).toString(BASE_36).substring(2);

const getRandom2DArray = (rows: number, cols: number, maxValue: number): number[][] =>
    Array.from({ length: rows }, () => Array.from({ length: cols }, () => Math.floor(Math.random() * maxValue)));

export const getFakeMaps = (count: number = GENERATE_COUNT): Map[] => {
    const maps: Map[] = [];
    for (let i = 0; i < count; i++) {
        const array2D = getRandom2DArray(ROW_LENGTH, COLUMN_LENGTH, TILE_COUNT);
        const isVisible = i % 2 === 0;
        maps.push({
            _id: new mongoose.Types.ObjectId().toHexString(),
            name: getRandomString(),
            description: getRandomString(),
            visible: isVisible,
            mode: MODES[Math.floor(Math.random() * MODES.length)],
            nbPlayers: NB_PLAYERS,
            image: 'Kratos.img',
            tiles: array2D,
            dimension: DIMENSION,
            itemPlacement: array2D,
            isSelected: false,
            lastModification: new Date(),
            creatorId: new mongoose.Types.ObjectId().toHexString(),
            creatorUsername: getRandomString(),
            state: GameState.Private,
        });
    }
    return maps;
};

export const NEW_MAP_NO_ID = {
    name: 'map name',
    description: 'description of the map',
    visible: true,
    mode: 'classique',
    nbPlayers: SMALL_MAP_PLAYERS,
    image: 'image string',
    tiles: [
        [
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
        ],
        [
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
            TileType.Ground,
        ],
    ],
    dimension: SIZE_SMALL_MAP,
    itemPlacement: [
        [NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM],
        [NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM, NO_ITEM],
    ],
    isSelected: false,
    lastModification: DEFAULT_DATE,
};

export const EXISTING_MAP = {
    _id: '66f7162b7ec70b6faefa36fd',
    name: 'old name',
    description: 'old description',
    visible: true,
    mode: 'classique',
    nbPlayers: MEDIUM_MAP_PLAYERS,
    image: 'old image string',
    tiles: [
        [
            TileType.Water,
            TileType.Ice,
            TileType.Ground,
            TileType.Ice,
            TileType.Wall,
            TileType.OpenDoor,
            TileType.Ground,
            TileType.Ground,
            TileType.Water,
            TileType.Ice,
            TileType.Water,
            TileType.Ice,
            TileType.Wall,
            TileType.OpenDoor,
        ],
        [
            TileType.Water,
            TileType.Ice,
            TileType.Ground,
            TileType.Ice,
            TileType.Wall,
            TileType.OpenDoor,
            TileType.Ground,
            TileType.Ground,
            TileType.Water,
            TileType.Ice,
            TileType.Ground,
            TileType.Water,
            TileType.Ice,
            TileType.Wall,
        ],
    ],
    dimension: SIZE_MEDIUM_MAP,
    itemPlacement: [
        [
            NO_ITEM,
            RANDOM_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            RANDOM_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
        ],
        [
            NO_ITEM,
            RANDOM_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            RANDOM_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
        ],
    ],
    isSelected: false,
    lastModification: DEFAULT_DATE,
};

export const MAP_TO_PUT = {
    _id: '66f7162b7ec70b6faefa36fd',
    name: 'new name for the map',
    description: 'a different description than the last one',
    visible: true,
    mode: 'classique',
    nbPlayers: MEDIUM_MAP_PLAYERS,
    image: 'a new image to represent the tiles',
    tiles: [
        [
            TileType.Water,
            TileType.Ice,
            TileType.Ground,
            TileType.Ice,
            TileType.Wall,
            TileType.OpenDoor,
            TileType.Ground,
            TileType.Ground,
            TileType.Water,
            TileType.Ice,
            TileType.Water,
            TileType.Ice,
            TileType.Wall,
            TileType.OpenDoor,
        ],
        [
            TileType.Water,
            TileType.Ice,
            TileType.Ground,
            TileType.Ice,
            TileType.Wall,
            TileType.OpenDoor,
            TileType.Ground,
            TileType.Ground,
            TileType.Water,
            TileType.Ice,
            TileType.Ground,
            TileType.Water,
            TileType.Ice,
            TileType.Wall,
        ],
    ],
    dimension: SIZE_MEDIUM_MAP,
    itemPlacement: [
        [
            NO_ITEM,
            RANDOM_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            RANDOM_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
        ],
        [
            NO_ITEM,
            RANDOM_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
            RANDOM_ITEM,
            NO_ITEM,
            NO_ITEM,
            NO_ITEM,
        ],
    ],
    isSelected: false,
    lastModification: DEFAULT_DATE,
};

export const mockGameNavigation: Game = {
    _id: '1',
    name: 'Mock Game',
    description: 'This is a mock game for testing purposes.',
    visible: true,
    mode: 'single-player',
    nbPlayers: 1,
    image: 'mock-image.png',
    tiles: [
        [TileType.Water, TileType.Water, TileType.Wall],
        [TileType.Water, TileType.OpenDoor, TileType.Wall],
        [TileType.Water, TileType.Water, TileType.Water],
    ],
    dimension: 3,
    itemPlacement: [
        [1, 0, 0],
        [0, 0, 0],
        [0, 0, 0],
    ],
    isSelected: false,
    lastModification: new Date(),
};

export const mockNeighborGame: Game = {
    _id: '1',
    name: 'map name',
    description: 'description for map',
    visible: true,
    mode: 'classique',
    nbPlayers: 1,
    image: 'image for map',
    tiles: [
        [TileType.Ground, TileType.Ground, TileType.Wall],
        [TileType.Ground, TileType.Ground, TileType.Ground],
        [TileType.Wall, TileType.Ground, TileType.Ground],
    ],
    dimension: 3,
    itemPlacement: [
        [1, 0, 0],
        [0, 0, 1],
        [0, 0, 0],
    ],
    isSelected: false,
    lastModification: new Date(),
};
